<!doctype html><html lang=en>
<head>
<title>
EDNS UDP packet size | Thoughts, Links & Moods
</title>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=HandheldFriendly content="True">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="jason.re • Thoughts, Links & Moods">
<meta name=author content="Jason Friedrich">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="EDNS UDP packet size">
<meta name=twitter:description content="A couple of weeks ago I set up a local BIND in a CentOS 6.5 VM to have an internal DNS server for my VMs to use. After creating several local zone files and successful initial tests, everything worked fine. Some domains had high query times, and SSH logins sometimes took a bit longer than expected, but I did not have enough time to investigate further.">
<meta property="og:title" content="EDNS UDP packet size">
<meta property="og:description" content="A couple of weeks ago I set up a local BIND in a CentOS 6.5 VM to have an internal DNS server for my VMs to use. After creating several local zone files and successful initial tests, everything worked fine. Some domains had high query times, and SSH logins sometimes took a bit longer than expected, but I did not have enough time to investigate further.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jason.re/post/edns-udp-packet-size/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-10-05T13:52:03+02:00">
<meta property="article:modified_time" content="2022-02-17T23:31:37+00:00">
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;700&display=swap" rel=stylesheet>
<link rel=preconnect href=https://cdn.jsdelivr.net>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css>
<link rel=stylesheet type=text/css href=/css/highlightjs/tomorrow-night.css>
<link rel=stylesheet href=/css/style.min.css>
<link rel="shortcut icon" href=/favicon.ico>
<script src=/js/highlight.pack.js></script>
<script>hljs.initHighlightingOnLoad()</script>
</head>
<body id=top class=main>
<header class=header>
<div class=header-logo>
<img class=logo title=About srcset="/images/author_hu737cdb9bf67d3c24ce670e322a5be00e_255619_122x0_resize_box_3.png, /images/author_hu737cdb9bf67d3c24ce670e322a5be00e_255619_244x0_resize_box_3.png 2x" alt="Blog Logo" src=/images/author_hu737cdb9bf67d3c24ce670e322a5be00e_255619_244x0_resize_box_3.png>
</div>
<h1 class=blog-title>Thoughts, Links & Moods</h1>
<nav class=header-nav>
<div class=grid-canvas>
<div class=primary-nav>
<a class=header-nav-entry title=Home href=/><i role=img class="bi bi-house-fill"></i><span>Home</span></a>
<a class=header-nav-entry title=About href=/about/><i role=img class="bi bi-person-fill"></i><span>About</span></a>
<a class=header-nav-entry title=Twitter href=https://twitter.com/jbfriedrich><i role=img class="bi bi-twitter"></i><span>Twitter</span></a>
</div>
</div>
</nav>
</header>
<main class=content>
<article class="full-post type-post">
<header class="post-header grid-canvas">
<h2 class=post-date>October 5, 2014</h2>
<h1 class="post-title has-feature-image">EDNS UDP packet size</h1>
<figure class="figure feature-figure">
<img alt="Page Feature Image" class=feature-image src="https://images.unsplash.com/photo-1532339848923-c4beffa7abcb?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ&s=24a4e38bb8b9e913fcc7bc041dd2ed2b">
</figure>
</header>
<main class="post-content grid-canvas">
<p>A couple of weeks ago I set up a local BIND in a CentOS 6.5 VM to have an internal DNS server for my VMs to use. After creating several local zone files and successful initial tests, everything worked fine. Some domains had high query times, and SSH logins sometimes took a bit longer than expected, but I did not have enough time to investigate further.</p>
<p>Today I had some free time on my hands and decided to re-visit the issue. The DNS server works fine, but whenever the cache is empty, it takes up to 3098ms for a DNS query. Once the result is in cache, everything works as expected. To get a better overview I started with enabling debug logging in ´named.conf´:</p>
<pre tabindex=0><code class=language-less data-lang=less>logging {
    channel default_debug {
        file &quot;data/named.run&quot;;
        severity debug;
        print-time yes;
        print-severity yes;
        print-category yes;
    };
    category default {
        default_debug;
    };
};
</code></pre><p>After a restart of the DNS service I tested several domains and found this suspicious log entry:</p>
<blockquote>
<p>05-Oct-2014 11:24:28.014 edns-disabled: debug 1: success resolving &lsquo;domain.com.dlv.isc.org/DLV&rsquo; (in &lsquo;isc.org&rsquo;?) after reducing the advertised EDNS UDP packet size to 512 octets</p>
</blockquote>
<p>I then remembered something a friend of mine told me a couple of months ago. Hetzner is using several Firewall and anti-DDOS techniques to prevent attacks. One of these techniques is blocking UDP packets greater a specific size (which is not publicly revealed). I found a <a href=https://kb.isc.org/article/AA-00708/0/Why-does-BIND-log-messages-about-disabling-EDNS-or-reducing-the-advertised-packet-size.html>knowledgebase</a> article and <a href=https://www.dns-oarc.net/oarc/services/replysizetest/>a way to test</a> if this is a problem with my local DNS server, or the one remote. It looks like the <a href=http://www.hetzner.de/>Hetzner</a> is blocking UDP packages which are greater than 1440 or sometimes 2200 bytes, sometimes I get even lower values. Pretty inconsistent results.</p>
<p>To be on the safe side, I edited the <em>named.conf</em> and set the values for &ldquo;edns-udp-size&rdquo; and &ldquo;max-udp-size&rdquo; to 512 bytes:</p>
<pre tabindex=0><code class=language-less data-lang=less>edns-udp-size           512;
max-udp-size            512;
</code></pre><p>This seems to work for me now. I also contacted <a href=http://www.hetzner.de/>Hetzner</a> and applied for the UDP whitelist.</p>
</main>
<aside class="tags grid-canvas">
<ul class=taglist>
<li class=tag><a class=tag-link href=/tags/linux title="Posts tagged with linux"><i class="bi bi-tag"></i>linux</a></li>
<li class=tag><a class=tag-link href=/tags/networking title="Posts tagged with networking"><i class="bi bi-tag"></i>networking</a></li>
<li class=tag><a class=tag-link href=/tags/tech title="Posts tagged with tech"><i class="bi bi-tag"></i>tech</a></li>
<li class=tag><a class=tag-link href=/tags/en title="Posts tagged with en"><i class="bi bi-tag"></i>en</a></li>
</ul>
</aside>
</article>
</main>
<div class=footer>
<div class=grid-canvas>
<div class=footer-nav>
<div class=notice>© 2022 Jason Friedrich</div>
<nav class=header-nav>
<div class=secondary-nav>
<a class="header-nav-entry desktop-nav-entry" title=Home href=/><i role=img class="bi bi-house-fill"></i><span>Home</span></a>
<a class="header-nav-entry desktop-nav-entry" title=About href=/about/><i role=img class="bi bi-person-fill"></i><span>About</span></a>
<a class="header-nav-entry desktop-nav-entry" title=Twitter href=https://twitter.com/jbfriedrich><i role=img class="bi bi-twitter"></i><span>Twitter</span></a>
<a class=header-nav-entry title="Top " href=#top>&#8593; Top &#8593;</a>
</div>
</nav>
</div>
</div>
</div>
</body>
</html>